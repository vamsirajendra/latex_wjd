\begin{figure}[h,centering]
  \caption{Proof of the 2nd Isomorphism Theorem}
  \label{fig:secondhomproof}
  \begin{center}
    \begin{tikzpicture}
      \draw[dashed,blue] (-.15,0.1) rectangle (4.15,1.1);
      \draw[dashed,red] (-.15,1.2) rectangle (4.15,2.1);
      \draw[dashed,green] (-.15,2.2) rectangle (4.15,3.1);
      \draw[dashed] (-.15,3.2) rectangle (4.15,4.1);

      \draw (0,0.2) rectangle (1.5,1)
      (1.6,0.2) rectangle (2,1)
      (2.1,0.2) rectangle (3,1)
      (3.1,0.2) rectangle (3.3,1)
      (3.4,0.2) rectangle (3.6,1)
      (3.7,0.2) rectangle (4,1);
      \fill (.3,.4) circle (1pt);
      \draw (.55,.4) node {$a_0$};
      \fill (1,.6) circle (1pt);
      \draw (1.25,.6) node {$a_1$};
      \fill (2.3,.4) circle (1pt);
      \draw (2.55,.4) node {$a_2$};

      \draw (0,1.3) rectangle (2,2)
      (2.1,1.3) rectangle (3,2)
      (3.1,1.3) rectangle (4,2);
      \fill (1.4,1.6) circle (1pt);
      \draw (1.65,1.6) node {$a_3$};

      \draw (0,2.3) rectangle (2.5,3)
      (2.6,2.3) rectangle (4,3);

      \draw (0,3.3) rectangle (1.2,4)
      (1.3,3.3) rectangle (2.3,4)
      (2.4,3.3) rectangle (2.6,4)
      (2.7,3.3) rectangle (4,4);
      % \fill (3.3,3.4) circle (1pt);
      % \draw (3.55,3.4) node {$a_4$};

      \path[->,font=\scriptsize]
      (4.3,.5) edge (6.5,.5);
      \path[->,font=\scriptsize]
      (4.3,1.5) edge  (6.25,1.5);
      \path[->,font=\scriptsize]
      (4.3,2.5) edge  (6.5,2.5);
      \path[->,font=\scriptsize]
      (4.3,3.5) edge (6.5,3.5);

      \draw[dotted] (6.7,2) ellipse (.7cm and 2.2cm);
      \draw (6.95,3.5) node {$b_3$};
      \fill (6.7,3.5) circle (2pt);
      \draw (6.95,2.5) node {$b_2$};
      \fill[green] (6.7,2.5) circle (2pt);
      \draw (6.65,1.5) node {$b_1$};
      \fill[red] (6.4,1.5) circle (2pt);
      \draw (6.95,.5) node {$b_0$};
      \fill[blue] (6.7,.5) circle (2pt);

      \draw(9,1.5) node {$b_1=f(a_3)$};
      \draw(10,.5) node {$b_0=f(a_0)=f(a_1)=f(a_2)$};

      \draw[font=\LARGE] (-1,3) node {$A$};
      \draw[font=\LARGE] (7.8,3) node {$B$};
      \draw[font=\LARGE] (-.5,-3) node {$g(A)$};
      \draw[font=\large] (5.25,4) node {$f$};
      \draw[blue] (-1.2,.5) node {$a_0/ker f$};
      \draw[blue] (-.5,.5) -- (-.3,.5);
      \draw (.4,-.5) node {$a_0/ker g$};
      \draw (.7,-.2) -- (.9,.3);

      \draw[font=\large] (1.7,-.9) node {$g$};
      % \draw[->,thick] (.3,-.2) to [out=230,in=100] (0,-1.5);
      \path[->,font=\scriptsize] (2,-.2) edge (2,-1.8);

      \draw[font=\large] (6.5,-3) node {$\psi$};
      \draw[->,loosely dashed, red] (4.2,-4) to [out=30,in=-100] (6.35,1.2);
      \draw[->,loosely dashed, blue] (4.2,-4.9) to [out=30,in=-100] (6.7,.2);


      % \draw(-1.5,-5.8) node {$g(a_0)=g(a_1)$};
      % \draw[->,semithick] (-.4,-5.7) to [out=15,in=225] (.5,-5.3);
      % \draw[dotted] (2,-3.7) ellipse (3.5cm and 2.3cm);

      \draw(-1.1,-5.5) node {$g(a_0)=g(a_1)$};
      \draw (0,-5.4) -- (.8,-5.25);
      \draw(2.4,-5.9) node {$g(a_2)$};
      \draw (2.4,-5.67) -- (2.4,-5.4);

      \draw[dotted,black] (2.3,-2.3) ellipse (2cm and .3cm);
      \fill (1,-2.3) circle (2pt);
      \fill (1.9,-2.3) circle (2pt);
      \fill (2.6,-2.3) circle (2pt);
      \fill (3.4,-2.3) circle (2pt);

      \draw[dotted,green] (2.3,-3.3) ellipse (1.5cm and .2cm);
      \fill (1.5,-3.3) circle (2pt);
      \fill (3.2,-3.3) circle (2pt);

      \draw[dotted,red] (2.3,-4.3) ellipse (2cm and .3cm);
      \fill (1.2,-4.3) circle (2pt);
      \fill (2.4,-4.3) circle (2pt);
      \fill (3.6,-4.3) circle (2pt);

      \draw[dotted,blue] (2.3,-5.2) ellipse (2cm and .3cm);
      \fill (1,-5.2) circle (2pt);
      \fill (1.8,-5.2) circle (2pt);
      \fill (2.4,-5.2) circle (2pt);
      \fill (3.1,-5.2) circle (2pt);
      \fill (3.4,-5.2) circle (2pt);
      \fill (3.8,-5.2) circle (2pt);

    \end{tikzpicture}
  \end{center}
\end{figure}
